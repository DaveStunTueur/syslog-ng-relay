
@version: 7.0
#Default configuration file for syslog-ng.
#
# For a description of syslog-ng configuration file directives, please read
# the syslog-ng Administrator's guide at:
#
# https://www.balabit.com/support/documentation
#
@include "scl.conf"

options {
stats_freq(0);
};

######
# sources
source s_local {
# message generated by Syslog-NG
internal();
system();
monitoring_welf();
};

source s_cisco_UCS_syslog_udp_tcp {
    udp(ip(0.0.0.0) port(514));
    tcp(ip(0.0.0.0) port(514));
};

source s_cisco_NXOS_syslog_udp_tcp {
    udp(ip(0.0.0.0) port(5145));
    tcp(ip(0.0.0.0) port(5145));
};

source s_OCP_syslog_udp_tcp {
    udp(ip(0.0.0.0) port(5144));
    tcp(ip(0.0.0.0) port(5144));
};

source s_AZS_syslog_udp_tcp {
    udp(ip(0.0.0.0) port(5146) so_rcvbuf (805306368) so_sndbuf(8096));
    tcp(ip(0.0.0.0) port(5146));
};


source s_test {
    network(
            ip(0.0.0.0)
            port(5555)
            transport("tcp")
            so_rcvbuf (52428800)
            so_sndbuf(8096)
            max-connections(300)
            log-iw-size(300000)
       );
};


######
# destinations
destination d_messages { file("/var/log/messages"); };

destination d_AZS_syslog_udp_tcp { file("/var/log/syslog-ng/AZS/$HOST/$YEAR-$MONTH-$DAY-syslog.log" create_dirs(yes)); };
destination d_cisco_UCS_syslog_udp_tcp { file("/var/log/syslog-ng/UCS/$HOST/$YEAR-$MONTH-$DAY-syslog.log" create_dirs(yes)); };
destination d_cisco_NXOS_syslog_udp_tcp { file("/var/log/syslog-ng/NXOS/$HOST/$YEAR-$MONTH-$DAY-syslog.log" create_dirs(yes)); };
destination d_OCP_syslog_udp_tcp { file("/var/log/syslog-ng/OCP/$HOST/$YEAR-$MONTH-$DAY-syslog.log" create_dirs(yes)); };

destination d_ECOP_ALTP {
        network(
            "167.43.11.13"
            port("5555")
            transport(altp(
                                allow-plain-compress(yes)
                                batch-size(1000)
                        ))
            ip-protocol(4)
            log-fifo-size(90000000)

            disk-buffer(
                        mem-buf-size(2000)
                        disk-buf-size(21474825485)
                        reliable(yes)
                        dir("/var/log/buffer/syslog-ng/syslog3/altp")
                       )

        );
};

######
# REWRITE

rewrite rw_syslog {
    subst("$",
        " SyslogRelay=$LOGHOST", value("MESSAGE"), flags() );
};


######
#LOG RULES

log {
source(s_local);
destination(d_messages);
};

#log { source(s_AZS_syslog_udp_tcp); destination(d_AZS_syslog_udp_tcp);  };
#log { source(s_AZS_syslog_udp_tcp); destination(d_ECOP); };
#log { source(s_apps_tcp); destination(d_test); };
#log { source(s_cisco_UCS_syslog_udp_tcp); destination(d_cisco_UCS_syslog_udp_tcp); };
#log { source(s_cisco_NXOS_syslog_udp_tcp); destination(d_cisco_NXOS_syslog_udp_tcp); };
#log { source(s_OCP_syslog_udp_tcp); destination(d_OCP_syslog_udp_tcp); };

log {
        source(s_test);
        rewrite(rw_syslog);
        destination (d_ECOP_ALTP);
        flags(flow-control);
};


