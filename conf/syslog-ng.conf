
@version: 7.0
#Default configuration file for syslog-ng.
#
# For a description of syslog-ng configuration file directives, please read
# the syslog-ng Administrator's guide at:
#
# https://www.balabit.com/support/documentation
#
@include "scl.conf"
@include "/opt/syslog-ng/etc/conf.d/*.conf"

options {
    stats_freq(0);
    on-error("drop-property");
    keep-hostname(yes);
    keep-timestamp(yes);
};

####################################
#
#   SOURCES
#
####################################

source s_local {
    system();
    monitoring_welf();
};

source s_syslog-ng {
    # message generated by Syslog-NG
    internal();
};

####################################
#
#   DESTINATIONS
#
####################################

destination d_messages { 
    file("/var/log/messages"); 
};

destination d_syslog-ng { 
    file("/var/log/syslog-ng/syslog-ng.log"); 
};

####################################
#
#   REWRITE
#
####################################

rewrite rw_syslog {
    subst("$", " SyslogRelay=$LOGHOST", value("MESSAGE"), flags() );
};

####################################
#
#   FILTER
#
####################################

filter f_syslog_conn { 
    not (match ("connection closed" value("MESSAGE")) or match ("connection accepted" value("MESSAGE"))); 
};

####################################
#
#   LOG
#
####################################

log {
    source(s_local);
    destination(d_messages);
};

log {
    source(s_syslog-ng);
    filter (f_syslog_conn);
    destination(d_syslog-ng);
};

